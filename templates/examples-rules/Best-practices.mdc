---
description: 
globs: 
alwaysApply: true
---
# Testing Best Practices

## Cuando modificas o creas componentes

Cuando modifiques o crees cualquier componente del sistema como controladores, servicios, modelos o recursos, sigue estas pautas:

### 1. Revisa los tests existentes

- Identifica qué tests ya existen para el componente que estás modificando
- Verifica los [tests unitarios](mdc:tests/Unit) y [tests de feature](mdc:tests/Feature) relacionados
- Revisa especialmente [ApiResponseTraitTest](mdc:tests/Unit/ApiResponseTraitTest.php) y [QueryOptionsTest](mdc:tests/Unit/QueryOptionsTest.php) para cambios en la API

### 2. Ejecuta tests según la magnitud del cambio

Para cambios pequeños o superficiales:
```bash
# Ejecuta sólo el test relacionado con tu cambio
php artisan test tests/path/to/specific/test.php
```

Para cambios significativos o de infraestructura core:
```bash
# Ejecuta una suite completa de tests
php artisan test tests/Feature/Api
# O todos los tests
php artisan test
```

### 3. Verifica formatos de respuesta API

Todo endpoint debe seguir el formato estándar de API:
- Estructura de éxito: `{status: "success", data: [...], message: "..."}`
- Estructura de error: `{status: "error", message: "..."}`
- Soporte para paginación en el campo `meta`
- Respeta la estructura definida en [ApiResponseTrait](mdc:app/Http/Traits/ApiResponseTrait.php)

### 4. Compatibilidad multi-tenant

Cualquier componente debe filtrar adecuadamente por tenant_id para respetar la arquitectura multi-tenant del sistema.

### 5. Corrección de errores

Si encuentras errores en tests:
1. Verifica primero si el error está en el test o en el código
2. Da prioridad a la corrección del código si el test verifica un comportamiento correcto
3. Actualiza tests si hubo cambios deliberados en el comportamiento esperado

### 6. Estados y enumeraciones

Mantén consistencia con estados y enumeraciones como en:
- Estados de leads: `['new', 'contacted', 'qualified', 'converted', 'lost']`
- Tipos de chat: `['lead_capture', 'assistance', 'custom']`
- Estados de conversación: `['active', 'completed', 'abandoned']`
- Tipos de tenant: `['COMPANY', 'RESELLER', 'FRANCHISE']`
