---
description: 
globs: cli/**/*,templates/**/*,kit-config.json,README.md
alwaysApply: false
---
# CLI development & Rule generation

When you modify the CLI or add new stack templates:

1. **CLI**
   * Update prompts in `cli/index.js`.
   * Organize helper functions in appropriate files in `cli/utils/`:
     * `file-helpers.js` - File operations and template processing
     * `stack-helpers.js` - Common stack functionality
     * `config.js` - Configuration and constants
     * Stack-specific helpers (e.g., `nextjs-helpers.js`)
   * Respect `templates/kit-config.json` for configuration.
   * Add/adjust helper scripts in `version-detector.js`.

2. **New stacks or architectures**
   * Create `templates/stacks/<stack>/base/` with generic rules.
   * Create `templates/stacks/<stack>/architectures/<arch_name>/` with architecture-specific rules.
   * Add overlay folders `v<major>/` for breaking changes only.
   * Update `kit-config.json`:
     * `globs`
     * `version_ranges`
     * `default_architecture`
     * `architectures` for stack-specific architectures
     * `pattern_rules` if needed.

3. **Template variables**
   * Use placeholders like `{projectPath}`, `{detectedVersion}`, `{versionRange}`, `{stack}` in templates.
   * These will be automatically replaced when generating rules.

4. **Docs**
   * Document new behaviour in `README.md` & `/docs/cli.md`.
   * Change `Implementation Status` block with percent progress of current implementations and add new if is a new implementation.

After changes, run:

```bash
pnpm run lint
pnpm run test
pnpx agent-rules-kit --update
```
